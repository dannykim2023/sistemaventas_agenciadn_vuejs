import{d as C,A as U,k as v,c as r,b as g,u as l,h,e as F,f as e,g as m,a as P,o as n,B as i,C as p,t as a,D as x,E as y,F as b,G as f,i as D}from"./app-CP_W2NH3.js";import{_ as E}from"./AppLayout.vue_vue_type_script_setup_true_lang-D_7fxc2B.js";import{d as j}from"./index-C4J_hXM0.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-WLrr3qR9.js";import"./useForwardExpose-CPzfMxLf.js";import"./VisuallyHidden-BRHHXUBF.js";import"./RovingFocusGroup-DKecLfH3.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./createLucideIcon-Cz7MFOQe.js";const T={class:"p-4 md:p-6 space-y-4"},M={class:"flex items-center justify-between"},B={class:"flex gap-2"},R=["disabled"],A={key:0,class:"mb-3 p-2 rounded bg-red-50 text-[11px] text-red-600"},$={class:"bg-white rounded-2xl shadow-sm border overflow-hidden"},G={class:"px-8 pt-6 pb-4 border-b grid md:grid-cols-2 gap-6"},I={class:"space-y-3"},O={key:0,class:"text-[11px] text-red-500 mt-1"},q={class:"space-y-3"},H={key:0,class:"text-[11px] text-red-500 mt-1"},L={class:"px-8 py-4 border-b bg-slate-50/60"},Y={class:"flex items-center gap-6 mb-4"},z={class:"flex items-center gap-2 text-sm"},J={class:"flex items-center gap-2 text-sm"},K={key:0,class:"grid md:grid-cols-2 gap-4"},Q=["value"],W={class:"text-[11px] text-muted-foreground mt-1"},X={class:"font-semibold text-red-600"},Z=["value"],ee={class:"px-6 py-4 border-t mt-2 bg-white rounded-xl shadow-sm border"},te={key:0,class:"overflow-x-auto"},se={class:"w-full text-xs md:text-sm border"},oe={class:"p-2 font-mono"},le={class:"p-2 text-right"},re={class:"p-2 text-right text-emerald-600"},ne={class:"p-2 text-right text-red-600"},ae={class:"p-2 text-center"},de=["onClick"],ie={key:1,class:"text-xs text-muted-foreground mt-2"},_e=C({__name:"Create",props:{customers:{},sales:{}},setup(_){const u=_,k=[{title:"Dashboard",href:j().url},{title:"Pagos / Ingresos",href:"/payments"},{title:"Nuevo ingreso",href:"/payments/create"}];function w(){return new Date().toISOString().substring(0,10)}const o=U({payment_date:w(),amount:null,method:"",reference:"",notes:"",currency:"PEN",associate_sale:!0,customer_id:null,sale_id:null}),c=v(()=>o.associate_sale?o.customer_id?u.sales.filter(d=>d.customer.id===o.customer_id):u.sales:[]),S=v(()=>o.customer_id?u.sales.filter(d=>d.customer.id===o.customer_id).reduce((d,t)=>d+Number(t.balance||0),0):0);function N(d){o.customer_id=d.customer.id,o.sale_id=d.id,o.amount=Number(d.balance)}function V(){o.post("/payments",{preserveScroll:!0})}return(d,t)=>(n(),r(b,null,[g(l(h),{title:"Nuevo ingreso"}),g(E,{breadcrumbs:k},{default:F(()=>[e("div",T,[e("div",M,[t[11]||(t[11]=e("div",null,[e("h1",{class:"text-xl font-semibold"},"Nuevo ingreso"),e("p",{class:"text-sm text-muted-foreground"}," Registra un pago recibido y, si deseas, asócialo a una venta existente. ")],-1)),e("div",B,[e("button",{type:"button",class:"px-3 py-2 text-sm rounded-lg border",onClick:t[0]||(t[0]=s=>l(P).get("/payments"))}," Cancelar "),e("button",{type:"button",class:"px-4 py-2 text-sm rounded-lg bg-primary text-white",disabled:l(o).processing,onClick:V}," Guardar ingreso ",8,R)])]),Object.keys(l(o).errors).length?(n(),r("div",A," Hay errores en el formulario. Revisa los campos marcados. ")):m("",!0),e("div",$,[e("div",G,[e("div",I,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-xs font-medium mb-1"},"Fecha *",-1)),i(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=s=>l(o).payment_date=s),class:"w-full border rounded-lg px-2 py-2 text-sm"},null,512),[[p,l(o).payment_date]]),l(o).errors.payment_date?(n(),r("p",O,a(l(o).errors.payment_date),1)):m("",!0)]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-xs font-medium mb-1"},"Método de pago",-1)),i(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>l(o).method=s),class:"w-full border rounded-lg px-2 py-2 text-sm"},[...t[13]||(t[13]=[e("option",{value:""},"Seleccione…",-1),e("option",{value:"efectivo"},"Efectivo",-1),e("option",{value:"transferencia"},"Transferencia",-1),e("option",{value:"tarjeta_credito"},"Tarjeta de crédito",-1),e("option",{value:"tarjeta_debito"},"Tarjeta de débito",-1),e("option",{value:"yape_plin"},"Yape / Plin",-1)])],512),[[x,l(o).method]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-xs font-medium mb-1"},"Moneda",-1)),i(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>l(o).currency=s),class:"w-full border rounded-lg px-2 py-2 text-sm"},[...t[15]||(t[15]=[e("option",{value:"PEN"},"PEN - Soles",-1),e("option",{value:"USD"},"USD - Dólares",-1)])],512),[[x,l(o).currency]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-xs font-medium mb-1"},"Referencia",-1)),i(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>l(o).reference=s),class:"w-full border rounded-lg px-2 py-2 text-sm",placeholder:"N° operación, voucher…"},null,512),[[p,l(o).reference]])])]),e("div",q,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs font-medium mb-1"},"Valor del ingreso *",-1)),i(e("input",{type:"number",step:"0.01","onUpdate:modelValue":t[5]||(t[5]=s=>l(o).amount=s),class:"w-full border rounded-lg px-2 py-2 text-sm text-right",placeholder:"0.00"},null,512),[[p,l(o).amount,void 0,{number:!0}]]),l(o).errors.amount?(n(),r("p",H,a(l(o).errors.amount),1)):m("",!0)]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-xs font-medium mb-1"},"Notas del recibo",-1)),i(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>l(o).notes=s),rows:"4",class:"w-full border rounded-lg px-3 py-2 text-sm",placeholder:"Notas internas sobre este ingreso..."},null,512),[[p,l(o).notes]])])])]),e("div",L,[t[27]||(t[27]=e("p",{class:"text-sm font-semibold mb-2"}," ¿Asociar este ingreso a una venta existente? ",-1)),t[28]||(t[28]=e("p",{class:"text-xs text-muted-foreground mb-3"}," Puedes registrar un ingreso sin necesidad de que esté asociado a una venta. ",-1)),e("div",Y,[e("label",z,[i(e("input",{type:"radio",class:"h-4 w-4",value:!0,"onUpdate:modelValue":t[7]||(t[7]=s=>l(o).associate_sale=s)},null,512),[[y,l(o).associate_sale]]),t[20]||(t[20]=e("span",null,"Sí",-1))]),e("label",J,[i(e("input",{type:"radio",class:"h-4 w-4",value:!1,"onUpdate:modelValue":t[8]||(t[8]=s=>l(o).associate_sale=s)},null,512),[[y,l(o).associate_sale]]),t[21]||(t[21]=e("span",null,"No",-1))])]),l(o).associate_sale?(n(),r("div",K,[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-xs font-medium mb-1"},"Contacto / Cliente",-1)),i(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>l(o).customer_id=s),class:"w-full border rounded-lg px-2 py-2 text-sm"},[t[22]||(t[22]=e("option",{value:null},"Seleccionar…",-1)),(n(!0),r(b,null,f(u.customers,s=>(n(),r("option",{key:s.id,value:s.id},a(s.name),9,Q))),128))],512),[[x,l(o).customer_id]]),e("p",W,[t[23]||(t[23]=D(" Pendiente por cobrar a este cliente: ",-1)),e("span",X," S/ "+a(S.value.toFixed(2)),1)])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-xs font-medium mb-1"},"Venta a asociar",-1)),i(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>l(o).sale_id=s),class:"w-full border rounded-lg px-2 py-2 text-sm"},[t[25]||(t[25]=e("option",{value:null},"Seleccionar venta con saldo…",-1)),(n(!0),r(b,null,f(c.value,s=>(n(),r("option",{key:s.id,value:s.id},a(s.series)+"-"+a(s.number)+" · "+a(s.customer.name)+" · saldo S/ "+a(Number(s.balance).toFixed(2)),9,Z))),128))],512),[[x,l(o).sale_id]])])])):m("",!0)])]),e("div",ee,[t[30]||(t[30]=e("h2",{class:"text-sm font-semibold mb-2"},"Ventas pendientes",-1)),c.value.length?(n(),r("div",te,[e("table",se,[t[29]||(t[29]=e("thead",{class:"bg-slate-50"},[e("tr",null,[e("th",{class:"p-2"},"Correlativo"),e("th",{class:"p-2 text-right"},"Total"),e("th",{class:"p-2 text-right"},"Cobrado"),e("th",{class:"p-2 text-right"},"Por cobrar"),e("th",{class:"p-2 text-center"},"Acción")])],-1)),e("tbody",null,[(n(!0),r(b,null,f(c.value,s=>(n(),r("tr",{key:s.id,class:"border-t"},[e("td",oe,a(s.series)+"-"+a(String(s.number).padStart(6,"0")),1),e("td",le,"S/ "+a(Number(s.total).toFixed(2)),1),e("td",re," S/ "+a(Number(s.paid).toFixed(2)),1),e("td",ne," S/ "+a(Number(s.balance).toFixed(2)),1),e("td",ae,[e("button",{type:"button",onClick:ue=>N(s),class:"px-2 py-1 border rounded-md text-xs"}," Usar esta venta ",8,de)])]))),128))])])])):(n(),r("p",ie," Este cliente no tiene ventas pendientes por cobrar. "))])])]),_:1})],64))}});export{_e as default};
