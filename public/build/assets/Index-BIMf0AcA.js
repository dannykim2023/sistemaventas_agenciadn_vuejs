import{d as G,r as x,c as i,b as y,u as k,h as I,e as c,f as t,g as u,J as E,i as _,t as n,o as r,j as w,B as d,n as C,F as S,G as L,D as $,C as b,L as J,a as v}from"./app-CP_W2NH3.js";import{_ as R}from"./AppLayout.vue_vue_type_script_setup_true_lang-D_7fxc2B.js";import{_ as h}from"./BaseTable.vue_vue_type_script_setup_true_lang-Ca1oE2MU.js";import{d as H}from"./index-C4J_hXM0.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-WLrr3qR9.js";import"./useForwardExpose-CPzfMxLf.js";import"./VisuallyHidden-BRHHXUBF.js";import"./RovingFocusGroup-DKecLfH3.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./createLucideIcon-Cz7MFOQe.js";const K={class:"p-4 md:p-6 space-y-4"},O={class:"flex items-center justify-between"},Q={class:"flex items-center gap-2"},W={class:"bg-white rounded-2xl shadow-sm border overflow-hidden"},X={key:0,class:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs"},Y={key:1,class:"px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs"},Z={key:2,class:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs"},ee={key:3,class:"px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs"},te={class:"text-right"},le={class:"bg-white dark:bg-card w-full max-w-2xl rounded-xl shadow-xl border p-6 space-y-4"},se={class:"flex items-center justify-between"},oe={class:"text-lg font-semibold"},ae={class:"grid md:grid-cols-2 gap-3"},ne={class:"font-medium"},ie={class:"md:col-span-2"},re={class:"md:col-span-2"},de={class:"font-medium"},ue={class:"flex justify-end gap-2 pt-2 border-t mt-2"},ve={class:"bg-white dark:bg-card w-full max-w-2xl rounded-xl shadow-2xl border p-6 space-y-5"},me={class:"flex items-center justify-between"},pe={class:"grid md:grid-cols-2 gap-3"},xe={class:"md:col-span-2"},ce=["value"],be={key:0,class:"text-xs text-red-600 mt-1"},fe={key:0,class:"text-xs text-red-600 mt-1"},ge={key:0},ye={key:0,class:"text-xs text-red-600 mt-1"},_e={class:"md:col-span-2 grid grid-cols-2 gap-3"},ke={class:"inline-flex items-center gap-2 mt-6"},we={class:"md:col-span-2"},Ce={class:"md:col-span-2"},Ve={class:"flex justify-end gap-2 pt-3 border-t mt-1"},Ee=["disabled"],Se={class:"bg-white dark:bg-card w-full max-w-md rounded-xl shadow-xl border p-6 space-y-4"},$e={class:"flex justify-end gap-2"},qe=G({__name:"Index",props:{quotations:{},customers:{},filters:{}},setup(N){const m=N,z=[{key:"number",label:"Correlativo"},{key:"customer",label:"Cliente"},{key:"issue_date",label:"Creación"},{key:"valid_until",label:"Vencimiento"},{key:"total",label:"Total",align:"right"},{key:"status",label:"Estado"}],D=[{key:"view",label:"Ver"},{key:"edit",label:"Editar"},{key:"pdf",label:"PDF"},{key:"delete",label:"Eliminar",variant:"danger"},{key:"to-sale",label:"Convertir en venta"}];function U(o){const{action:e,row:s}=o;if(e==="view"){j(s);return}if(e==="edit"){v.get(`/quotations/${s.id}/edit`);return}if(e==="pdf"){window.open(`/quotations/${s.id}/pdf`,"_blank");return}if(e==="delete"){M(s);return}e==="to-sale"&&v.get("/sales/create",{quotation_id:s.id})}function P(o){v.get("/quotations",{page:o,search:F.value||void 0},{preserveState:!0,preserveScroll:!0})}const T=[{title:"Dashboard",href:H().url},{title:"Cotizaciones",href:"/quotations"}],F=x(m.filters?.search??""),f=x(!1),p=x(!1),g=x(!1),a=x(null),l=x({id:0,customer_id:null,issue_date:"",valid_until:"",currency:"PEN",exchange_rate:null,tax_included:!0,igv_rate:.18,notes:"",terms:"",processing:!1,errors:{}});function V(o){l.value.id=o.id,l.value.customer_id=o.customer_id??o.customer?.id??null,l.value.issue_date=o.issue_date,l.value.valid_until=o.valid_until,l.value.currency=o.currency||"PEN",l.value.exchange_rate=o.exchange_rate,l.value.tax_included=!!o.tax_included,l.value.igv_rate=Number(o.igv_rate??.18),l.value.notes=o.notes||"",l.value.terms=o.terms||"",l.value.errors={}}function j(o){a.value=o,V(o),f.value=!0}function A(o){a.value=o,V(o),p.value=!0}function M(o){a.value=o,g.value=!0}function q(){l.value.id&&(l.value.processing=!0,v.put(`/quotations/${l.value.id}`,{customer_id:l.value.customer_id,issue_date:l.value.issue_date,valid_until:l.value.valid_until,currency:l.value.currency,exchange_rate:l.value.exchange_rate,tax_included:l.value.tax_included,igv_rate:l.value.igv_rate,notes:l.value.notes,terms:l.value.terms},{onError:o=>{l.value.errors=o||{}},onFinish:()=>{l.value.processing=!1},onSuccess:()=>{p.value=!1,v.reload({only:["quotations"]})}}))}function B(){a.value&&v.delete(`/quotations/${a.value.id}`,{preserveScroll:!0,onSuccess:()=>{g.value=!1,a.value=null,v.reload({only:["quotations"]})}})}return(o,e)=>(r(),i(S,null,[y(k(I),{title:"Cotizaciones"}),y(R,{breadcrumbs:T},{default:c(()=>[t("div",K,[t("div",O,[e[19]||(e[19]=t("div",null,[t("h1",{class:"text-xl font-semibold"},"Cotizaciones"),t("p",{class:"text-sm text-muted-foreground"}," Crea y gestiona cotizaciones personalizadas. ")],-1)),t("div",Q,[y(k(E),{href:"/quotations/create",class:"px-4 py-2 rounded-lg bg-primary text-white text-sm font-medium hover:bg-primary/90 transition"},{default:c(()=>[...e[18]||(e[18]=[_(" + Nueva cotización ",-1)])]),_:1})])]),t("div",W,[y(h,{columns:z,rows:m.quotations.data,pagination:{currentPage:m.quotations.current_page,lastPage:m.quotations.last_page,perPage:10,total:m.quotations.total},selectable:!0,actions:D,onChangePage:P,onAction:U},{"cell-customer":c(({row:s})=>[_(n(s.customer?.name||"Cliente general"),1)]),"cell-status":c(({row:s})=>[s.status==="draft"?(r(),i("span",X," Borrador ")):s.status==="sent"?(r(),i("span",Y," Enviado ")):s.status==="accepted"?(r(),i("span",Z," Aceptado ")):(r(),i("span",ee," Por cobrar "))]),"cell-total":c(({row:s})=>[t("div",te,n(s.currency==="USD"?"$":"S/")+" "+n(Number(s.total??0).toFixed(2)),1)]),_:1},8,["rows","pagination"])])]),f.value&&a.value?(r(),i("div",{key:0,class:"fixed inset-0 bg-black/30 grid place-items-center z-50",onClick:e[3]||(e[3]=w(s=>f.value=!1,["self"]))},[t("div",le,[t("div",se,[t("h3",oe," Cotización "+n(a.value.number),1),t("button",{class:"opacity-70 hover:opacity-100",onClick:e[0]||(e[0]=s=>f.value=!1)}," ✕ ")]),t("div",ae,[t("div",null,[e[20]||(e[20]=t("div",{class:"text-xs text-muted-foreground"},"Cliente",-1)),t("div",ne,n(a.value.customer?.name||"—"),1)]),t("div",null,[e[21]||(e[21]=t("div",{class:"text-xs text-muted-foreground"},"Estado",-1)),t("div",null,n(a.value.status),1)]),t("div",null,[e[22]||(e[22]=t("div",{class:"text-xs text-muted-foreground"},"Fecha",-1)),t("div",null,n(a.value.issue_date),1)]),t("div",null,[e[23]||(e[23]=t("div",{class:"text-xs text-muted-foreground"},"Vencimiento",-1)),t("div",null,n(a.value.valid_until||"—"),1)]),t("div",null,[e[24]||(e[24]=t("div",{class:"text-xs text-muted-foreground"},"Moneda",-1)),t("div",null,n(a.value.currency),1)]),t("div",null,[e[25]||(e[25]=t("div",{class:"text-xs text-muted-foreground"},"Tipo de cambio",-1)),t("div",null,n(a.value.exchange_rate??"—"),1)]),t("div",null,[e[26]||(e[26]=t("div",{class:"text-xs text-muted-foreground"},"IGV incluido",-1)),t("div",null,n(a.value.tax_included?"Sí":"No"),1)]),t("div",null,[e[27]||(e[27]=t("div",{class:"text-xs text-muted-foreground"},"Tasa IGV",-1)),t("div",null,n(Number(a.value.igv_rate??0)*100)+"%",1)]),t("div",ie,[e[28]||(e[28]=t("div",{class:"text-xs text-muted-foreground"},"Notas",-1)),t("div",null,n(a.value.notes||"—"),1)]),t("div",re,[e[29]||(e[29]=t("div",{class:"text-xs text-muted-foreground"},"Términos",-1)),t("div",null,n(a.value.terms||"—"),1)]),t("div",null,[e[30]||(e[30]=t("div",{class:"text-xs text-muted-foreground"},"Total",-1)),t("div",de," S/ "+n(Number(a.value.total??0).toFixed(2)),1)])]),t("div",ue,[t("button",{class:"px-3 py-2 rounded border",onClick:e[1]||(e[1]=s=>f.value=!1)}," Cerrar "),t("button",{class:"px-3 py-2 rounded border",onClick:e[2]||(e[2]=s=>A(a.value))}," Editar "),y(k(E),{href:`/quotations/${a.value.id}`,class:"px-3 py-2 rounded border"},{default:c(()=>[...e[31]||(e[31]=[_(" Abrir ",-1)])]),_:1},8,["href"])])])])):u("",!0),p.value?(r(),i("div",{key:1,class:"fixed inset-0 bg-black/40 grid place-items-center z-50",onClick:e[15]||(e[15]=w(s=>p.value=!1,["self"]))},[t("div",ve,[t("div",me,[e[32]||(e[32]=t("h3",{class:"text-lg font-semibold"},"Editar cotización",-1)),t("button",{class:"opacity-70 hover:opacity-100",onClick:e[4]||(e[4]=s=>p.value=!1)}," ✕ ")]),t("div",pe,[t("div",xe,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium mb-1"},"Cliente *",-1)),d(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.customer_id=s),class:C(["w-full border rounded-lg px-2 py-2",{"border-red-500":!!l.value.errors.customer_id}])},[e[33]||(e[33]=t("option",{value:null,disabled:""},"Selecciona cliente…",-1)),(r(!0),i(S,null,L(m.customers,s=>(r(),i("option",{key:s.id,value:s.id},n(s.name),9,ce))),128))],2),[[$,l.value.customer_id]]),l.value.errors.customer_id?(r(),i("p",be,n(l.value.errors.customer_id),1)):u("",!0)]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium mb-1"},"Fecha *",-1)),d(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=s=>l.value.issue_date=s),class:C(["w-full border rounded-lg px-2 py-2",{"border-red-500":!!l.value.errors.issue_date}])},null,2),[[b,l.value.issue_date]]),l.value.errors.issue_date?(r(),i("p",fe,n(l.value.errors.issue_date),1)):u("",!0)]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium mb-1"},"Vencimiento",-1)),d(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=s=>l.value.valid_until=s),class:"w-full border rounded-lg px-2 py-2"},null,512),[[b,l.value.valid_until]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium mb-1"},"Moneda",-1)),d(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.currency=s),class:"w-full border rounded-lg px-2 py-2"},[...e[37]||(e[37]=[t("option",{value:"PEN"},"PEN - Soles",-1),t("option",{value:"USD"},"USD - Dólares",-1)])],512),[[$,l.value.currency]])]),l.value.currency==="USD"?(r(),i("div",ge,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium mb-1"}," Tipo de cambio ",-1)),d(t("input",{type:"number",step:"0.0001","onUpdate:modelValue":e[9]||(e[9]=s=>l.value.exchange_rate=s),class:C(["w-full border rounded-lg px-2 py-2",{"border-red-500":!!l.value.errors.exchange_rate}])},null,2),[[b,l.value.exchange_rate,void 0,{number:!0}]]),l.value.errors.exchange_rate?(r(),i("p",ye,n(l.value.errors.exchange_rate),1)):u("",!0)])):u("",!0),t("div",_e,[t("label",ke,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=s=>l.value.tax_included=s)},null,512),[[J,l.value.tax_included]]),e[40]||(e[40]=t("span",null,"Precios incluyen IGV",-1))]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium mb-1"},"Tasa IGV",-1)),d(t("input",{type:"number",step:"0.01",min:"0",max:"1","onUpdate:modelValue":e[11]||(e[11]=s=>l.value.igv_rate=s),class:"w-full border rounded-lg px-2 py-2"},null,512),[[b,l.value.igv_rate,void 0,{number:!0}]])])]),t("div",we,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium mb-1"},"Notas",-1)),d(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=s=>l.value.notes=s),rows:"3",class:"w-full border rounded-lg px-3 py-2"},null,512),[[b,l.value.notes]])]),t("div",Ce,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium mb-1"},"Términos",-1)),d(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>l.value.terms=s),rows:"3",class:"w-full border rounded-lg px-3 py-2"},null,512),[[b,l.value.terms]])])]),t("div",Ve,[t("button",{class:"px-3 py-2 rounded border",onClick:e[14]||(e[14]=s=>p.value=!1)}," Cancelar "),t("button",{class:"px-4 py-2 rounded bg-primary text-white",disabled:l.value.processing,onClick:q},n(l.value.processing?"Actualizando…":"Actualizar"),9,Ee)])])])):u("",!0),g.value?(r(),i("div",{key:2,class:"fixed inset-0 bg-black/40 grid place-items-center z-50",onClick:e[17]||(e[17]=w(s=>g.value=!1,["self"]))},[t("div",Se,[e[46]||(e[46]=t("h3",{class:"text-lg font-semibold"},"Eliminar cotización",-1)),t("p",null,[e[44]||(e[44]=_(" ¿Seguro que deseas eliminar ",-1)),t("b",null,n(a.value?.number),1),e[45]||(e[45]=_("? Esta acción no se puede deshacer. ",-1))]),t("div",$e,[t("button",{class:"px-3 py-2 rounded border",onClick:e[16]||(e[16]=s=>g.value=!1)}," Cancelar "),t("button",{class:"px-4 py-2 rounded bg-red-600 text-white",onClick:B}," Eliminar ")])])])):u("",!0)]),_:1})],64))}});export{qe as default};
