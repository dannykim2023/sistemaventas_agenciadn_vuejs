import{d as E,r as G,A as q,k as w,w as M,c,f as t,b as h,e as P,i as $,u as i,J as B,K as L,B as u,D as f,F as g,G as U,C as a,g as A,t as r,a as O,o as m}from"./app-CP_W2NH3.js";import{C as z}from"./CustomerModal-uMhdQZ2y.js";const R={class:"flex items-center justify-between"},J={class:"flex gap-2"},K=["disabled"],Q={class:"bg-white rounded-2xl shadow-sm border overflow-hidden"},W={class:"px-8 py-4 grid md:grid-cols-2 gap-6 bg-slate-50/60 border-b"},H={class:"space-y-3"},X={class:"flex items-end gap-2"},Y=["value"],Z={class:"grid sm:grid-cols-2 gap-3"},tt={class:"grid sm:grid-cols-2 gap-3"},et={key:0},st={class:"px-8 pt-4 pb-2"},ot={class:"overflow-x-auto"},nt={class:"w-full text-xs md:text-sm"},lt={class:"p-2"},dt=["onUpdate:modelValue","onChange"],it=["value"],ut={class:"p-2"},at=["onUpdate:modelValue"],rt={class:"p-2"},pt=["onUpdate:modelValue"],ct={class:"p-2"},mt=["onUpdate:modelValue"],xt={class:"p-2"},bt=["onUpdate:modelValue"],_t={class:"p-2"},ft=["onUpdate:modelValue"],gt={class:"p-2"},vt=["onUpdate:modelValue"],yt={class:"p-2 text-right font-medium"},wt={class:"p-2 text-right"},Ut=["onClick"],Vt={class:"px-8 pb-8 pt-4 border-t grid md:grid-cols-3 gap-6"},qt={class:"md:col-span-2 space-y-4"},ht={class:"grid md:grid-cols-2 gap-4"},kt={class:"bg-slate-50 rounded-xl border px-4 py-4 flex flex-col gap-2 justify-between"},Ct={class:"space-y-1 text-sm"},Dt={class:"flex justify-between"},Nt={class:"flex justify-between"},St={class:"flex justify-between"},jt={class:"border-t mt-2 pt-2 flex justify-between font-semibold"},Tt=E({__name:"QuotationForm",props:{customers:{},products:{},mode:{},quotation:{}},setup(k){const b=G(!1);q({type:"company",document_type:"RUC",document_number:"",name:"",email:"",phone:"",address:"",notes:"",is_active:!0});const d=k,v=w(()=>d.mode==="edit"),o=q(v.value&&d.quotation?{customer_id:d.quotation.customer_id,customer_tax_id:d.customers.find(e=>e.id===d.quotation.customer_id)?.tax_id??d.quotation.customer?.document_number??"",customer_phone:d.customers.find(e=>e.id===d.quotation.customer_id)?.phone??d.quotation.customer?.phone??"",issue_date:d.quotation.issue_date,valid_until:d.quotation.valid_until??d.quotation.issue_date,currency:d.quotation.currency,exchange_rate:d.quotation.exchange_rate,notes:d.quotation.notes??"",terms:d.quotation.terms??"",items:d.quotation.items.length>0?d.quotation.items.map(n=>({product_id:n.product_id,description:n.description??"",unit:n.unit??"UND",quantity:n.quantity??1,unit_price:n.unit_price??0,discount_pct:n.discount_pct??0,discount_amount:n.discount_amount??0,tax_pct:n.tax_pct??.18})):[{product_id:null,description:"",unit:"UND",quantity:1,unit_price:0,discount_pct:0,discount_amount:0,tax_pct:.18}]}:{customer_id:null,customer_tax_id:"",customer_phone:"",issue_date:new Date().toISOString().substring(0,10),valid_until:new Date().toISOString().substring(0,10),currency:"PEN",exchange_rate:null,notes:"",terms:"",items:[{product_id:null,description:"",unit:"UND",quantity:1,unit_price:0,discount_pct:0,discount_amount:0,tax_pct:.18}]}),x=w(()=>o.currency==="USD"?"$":"S/");function C(n){const e=(n.quantity||0)*(n.unit_price||0),s=e*((n.discount_pct||0)/100),p=e-s,l=p*(n.tax_pct||0);return p+l}M(()=>o.customer_id,n=>{if(!n){o.customer_tax_id="",o.customer_phone="";return}const e=d.customers.find(s=>s.id==n);e?(o.customer_tax_id=e.tax_id??"",o.customer_phone=e.phone??""):(o.customer_tax_id="",o.customer_phone="")},{immediate:v.value});function D(){o.items.push({product_id:null,description:"",unit:"UND",quantity:1,unit_price:0,discount_pct:0,discount_amount:0,tax_pct:.18})}function N(n){o.items.splice(n,1)}function S(n){const e=o.items[n].product_id;if(!e)return;const s=d.products.find(p=>p.id===e);s&&(o.items[n].description=s.name,o.items[n].unit=s.unit,o.items[n].unit_price=s.price,o.items[n].tax_pct=s.tax_pct)}const _=w(()=>{let n=0,e=0,s=0;for(const l of o.items){const F=l.quantity||0,I=l.unit_price||0,y=F*I,V=y*((l.discount_pct||0)/100),T=y-V;n+=y,e+=V,s+=T*(l.tax_pct||0)}const p=n-e+s;return{subtotal:n,discount:e,tax:s,total:p}}),j=()=>{v.value&&d.quotation?o.put(`/quotations/${d.quotation.id}`):o.post("/quotations")};return(n,e)=>(m(),c(g,null,[t("div",R,[e[13]||(e[13]=t("h1",{class:"text-xl font-semibold"},"Nueva cotización",-1)),t("div",J,[h(i(B),{href:"/quotations",class:"px-3 py-2 rounded-lg border bg-background hover:bg-muted/60 text-sm"},{default:P(()=>[...e[12]||(e[12]=[$(" Cancelar ",-1)])]),_:1}),t("button",{class:"px-4 py-2 rounded-lg bg-primary text-primary-foreground text-sm",disabled:i(o).processing,onClick:j}," Guardar ",8,K)])]),t("div",Q,[e[34]||(e[34]=L('<div class="px-8 pt-6 pb-4 flex items-start justify-between gap-6 border-b"><div class="flex items-center gap-3"><div class="h-12 w-32 bg-slate-100 rounded-md flex items-center justify-center text-[10px] font-semibold text-slate-500"> LOGO </div><div><p class="text-sm font-semibold">AGENCIA DN</p><p class="text-xs text-muted-foreground"> Marketing &amp; Diseño Web </p></div></div><div class="text-right"><p class="text-[11px] uppercase tracking-wide text-muted-foreground"> Cotización </p><p class="text-2xl font-semibold leading-tight"> No. <span class="align-middle text-base text-muted-foreground">—</span></p><p class="mt-1 text-xs text-muted-foreground"> Emitida por: Dani </p></div></div>',1)),t("div",W,[t("div",H,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-xs font-medium mb-1"},"Cliente *",-1)),t("div",X,[u(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>i(o).customer_id=s),class:"flex-1 border rounded-lg px-2 py-2 text-sm"},[e[14]||(e[14]=t("option",{value:null,disabled:""},"Selecciona cliente…",-1)),(m(!0),c(g,null,U(d.customers,s=>(m(),c("option",{key:s.id,value:s.id},r(s.name),9,Y))),128))],512),[[f,i(o).customer_id]]),t("button",{type:"button",class:"inline-flex items-center gap-1 text-xs text-primary hover:underline mb-1",onClick:e[1]||(e[1]=s=>b.value=!0)},[...e[15]||(e[15]=[t("span",{class:"text-lg leading-none"},"＋",-1),t("span",null,"Nuevo cliente",-1)])])])]),t("div",Z,[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-xs font-medium mb-1 opacity-60"}," Identificación ",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>i(o).customer_tax_id=s),readonly:"",class:"w-full border rounded-lg px-2 py-2 text-sm bg-gray-100 opacity-60",placeholder:"RUC / DNI"},null,512),[[a,i(o).customer_tax_id]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-xs font-medium mb-1 opacity-60"}," Teléfono ",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>i(o).customer_phone=s),readonly:"",class:"w-full border rounded-lg px-2 py-2 text-sm bg-gray-100 opacity-60",placeholder:"Teléfono"},null,512),[[a,i(o).customer_phone]])])])]),t("div",tt,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-xs font-medium mb-1"},"Creación *",-1)),u(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=s=>i(o).issue_date=s),class:"w-full border rounded-lg px-2 py-2 text-sm"},null,512),[[a,i(o).issue_date]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-xs font-medium mb-1"},"Vencimiento",-1)),u(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>i(o).valid_until=s),class:"w-full border rounded-lg px-2 py-2 text-sm"},null,512),[[a,i(o).valid_until]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-xs font-medium mb-1"},"Moneda",-1)),u(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>i(o).currency=s),class:"w-full border rounded-lg px-2 py-2 text-sm"},[...e[21]||(e[21]=[t("option",{value:"PEN"},"PEN - Soles",-1),t("option",{value:"USD"},"USD - Dólares",-1)])],512),[[f,i(o).currency]])]),i(o).currency==="USD"?(m(),c("div",et,[e[23]||(e[23]=t("label",{class:"block text-xs font-medium mb-1"},"Tipo de cambio",-1)),u(t("input",{type:"number",step:"0.0001","onUpdate:modelValue":e[7]||(e[7]=s=>i(o).exchange_rate=s),class:"w-full border rounded-lg px-2 py-2 text-sm"},null,512),[[a,i(o).exchange_rate,void 0,{number:!0}]])])):A("",!0)])]),t("div",st,[t("div",ot,[t("table",nt,[e[26]||(e[26]=t("thead",{class:"bg-slate-50 border-y"},[t("tr",{class:"text-left"},[t("th",{class:"p-2 w-56"},"Item facturable"),t("th",{class:"p-2 w-24"},"Referencia"),t("th",{class:"p-2 w-24"},"Precio un."),t("th",{class:"p-2 w-20"},"Desc %"),t("th",{class:"p-2 w-20"},"Impuesto"),t("th",{class:"p-2"},"Descripción"),t("th",{class:"p-2 w-20"},"Cantidad"),t("th",{class:"p-2 w-24 text-right"},"Total"),t("th",{class:"p-2 w-8"})])],-1)),t("tbody",null,[(m(!0),c(g,null,U(i(o).items,(s,p)=>(m(),c("tr",{key:p,class:"border-b last:border-b-0"},[t("td",lt,[u(t("select",{"onUpdate:modelValue":l=>s.product_id=l,onChange:l=>S(p),class:"w-full border rounded-lg px-2 py-1 text-xs md:text-sm"},[e[24]||(e[24]=t("option",{value:null},"Buscar item facturable…",-1)),(m(!0),c(g,null,U(d.products,l=>(m(),c("option",{key:l.id,value:l.id},r(l.name),9,it))),128))],40,dt),[[f,s.product_id]])]),t("td",ut,[u(t("input",{"onUpdate:modelValue":l=>s.unit=l,class:"w-full border rounded-lg px-2 py-1 text-xs md:text-sm",placeholder:"UND"},null,8,at),[[a,s.unit]])]),t("td",rt,[u(t("input",{type:"number",step:"0.01","onUpdate:modelValue":l=>s.unit_price=l,class:"w-full border rounded-lg px-2 py-1 text-xs md:text-sm text-right"},null,8,pt),[[a,s.unit_price,void 0,{number:!0}]])]),t("td",ct,[u(t("input",{type:"number",step:"0.01","onUpdate:modelValue":l=>s.discount_pct=l,class:"w-full border rounded-lg px-2 py-1 text-xs md:text-sm text-right"},null,8,mt),[[a,s.discount_pct,void 0,{number:!0}]])]),t("td",xt,[u(t("select",{"onUpdate:modelValue":l=>s.tax_pct=l,class:"w-28 border rounded-lg px-3 py-2 text-sm"},[...e[25]||(e[25]=[t("option",{value:0},"Ninguno (0%)",-1),t("option",{value:0},"Exonerado (0%)",-1),t("option",{value:.18},"IGV (18%)",-1)])],8,bt),[[f,s.tax_pct,void 0,{number:!0}]])]),t("td",_t,[u(t("input",{"onUpdate:modelValue":l=>s.description=l,class:"w-full border rounded-lg px-2 py-1 text-xs md:text-sm",placeholder:"Descripción del ítem"},null,8,ft),[[a,s.description]])]),t("td",gt,[u(t("input",{type:"number",step:"0.001","onUpdate:modelValue":l=>s.quantity=l,class:"w-full border rounded-lg px-2 py-1 text-xs md:text-sm text-right"},null,8,vt),[[a,s.quantity,void 0,{number:!0}]])]),t("td",yt,r(x.value)+" "+r(C(s).toFixed(2)),1),t("td",wt,[t("button",{class:"text-red-500 text-sm",onClick:l=>N(p)}," ✕ ",8,Ut)])]))),128))])])]),t("div",{class:"pt-3"},[t("button",{class:"text-primary text-sm font-medium",type:"button",onClick:D}," + Agregar línea ")])]),t("div",Vt,[t("div",qt,[e[29]||(e[29]=t("div",{class:"h-24 border-2 border-dashed rounded-xl flex flex-col items-center justify-center text-[11px] text-muted-foreground bg-slate-50"},[t("span",{class:"font-medium"},"Utilizar mi firma"),t("span",{class:"text-[10px]"},"178 x 51 píxeles")],-1)),t("div",ht,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-xs font-medium mb-1"}," Términos y condiciones ",-1)),u(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>i(o).terms=s),rows:"4",class:"w-full border rounded-lg px-3 py-2 text-sm",placeholder:"Visible en la impresión del documento"},null,512),[[a,i(o).terms]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-xs font-medium mb-1"}," Notas ",-1)),u(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>i(o).notes=s),rows:"4",class:"w-full border rounded-lg px-3 py-2 text-sm",placeholder:"Visible en la impresión del documento"},null,512),[[a,i(o).notes]])])])]),t("div",kt,[t("div",Ct,[t("div",Dt,[e[30]||(e[30]=t("span",{class:"text-muted-foreground"},"Subtotal",-1)),t("span",null,r(x.value)+" "+r(_.value.subtotal.toFixed(2)),1)]),t("div",Nt,[e[31]||(e[31]=t("span",{class:"text-muted-foreground"},"Descuento",-1)),t("span",null,"- "+r(x.value)+" "+r(_.value.discount.toFixed(2)),1)]),t("div",St,[e[32]||(e[32]=t("span",{class:"text-muted-foreground"},"IGV",-1)),t("span",null,r(x.value)+" "+r(_.value.tax.toFixed(2)),1)]),t("div",jt,[e[33]||(e[33]=t("span",null,"Total",-1)),t("span",null,r(x.value)+" "+r(_.value.total.toFixed(2)),1)])])])])]),h(z,{open:b.value,mode:"create",onClose:e[10]||(e[10]=s=>b.value=!1),onSaved:e[11]||(e[11]=()=>{b.value=!1,i(O).reload({only:["customers"]})})},null,8,["open"])],64))}});export{Tt as _};
