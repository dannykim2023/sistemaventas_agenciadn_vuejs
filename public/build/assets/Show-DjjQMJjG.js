import{d as U,k as c,r as E,A as T,I as $,e as h,f as t,c as i,g as m,t as s,i as g,n as w,b as F,u as d,J as C,o as r,F as S,G as V,B as p,C as f,D as I,a as R}from"./app-CZGxpMu4.js";import{_ as B}from"./AppLayout.vue_vue_type_script_setup_true_lang-fsc1CXWY.js";import{d as G}from"./index-C4J_hXM0.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-59Mo48T7.js";import"./useForwardExpose-C9xLoNo1.js";import"./VisuallyHidden-CyaeyaAO.js";import"./RovingFocusGroup-Dongv5Iv.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./createLucideIcon-BIN8wtFf.js";const A={class:"flex items-center justify-between mb-4"},O={class:"text-xl font-semibold"},z={class:"text-xs text-muted-foreground mt-1"},L={class:"flex gap-2"},q={class:"bg-white rounded-xl shadow-sm border mb-6 px-6 py-4"},H={class:"grid grid-cols-2 md:grid-cols-4 text-center divide-y md:divide-y-0 md:divide-x"},J={class:"py-3 px-4"},W={class:"text-lg font-semibold"},Y={class:"py-3 px-4"},K={class:"text-lg font-semibold text-red-500"},Q={class:"py-3 px-4"},X={class:"text-lg font-semibold text-emerald-600"},Z={class:"py-3 px-4"},tt={key:0,class:"mb-3 p-2 rounded bg-red-50 text-[11px] text-red-600"},et={class:"bg-white rounded-2xl shadow-sm border overflow-hidden mb-6"},st={class:"px-8 pt-6 pb-4 flex items-start justify-between gap-6 border-b"},lt={class:"text-right space-y-2"},ot={class:"text-2xl font-semibold leading-tight"},at={class:"align-middle text-base text-muted-foreground"},dt={class:"grid grid-cols-2 gap-2 text-xs"},nt={class:"text-left"},rt=["value"],it={class:"text-left"},ut=["value"],mt={class:"px-8 py-4 grid md:grid-cols-2 gap-6 bg-slate-50/60 border-b"},xt={class:"space-y-3"},pt=["value"],bt={class:"grid sm:grid-cols-2 gap-3"},ct=["value"],gt=["value"],ft={class:"grid sm:grid-cols-2 gap-3"},vt=["value"],yt=["value"],ht=["value"],wt=["value"],_t={class:"px-8 pt-4 pb-2"},kt={class:"overflow-x-auto"},Nt={class:"w-full text-xs md:text-sm"},Ft={class:"bg-slate-50 border-y"},Ct={class:"text-left"},St={class:"p-2 w-24 text-right"},Vt={class:"p-2"},jt={class:"p-2"},Dt={class:"p-2 text-right"},Mt={class:"p-2 text-right"},Pt={class:"p-2 text-right"},Ut={class:"p-2 text-right"},Et={class:"p-2 text-right font-medium"},Tt={class:"px-1 pt-3 pb-5 grid md:grid-cols-3 gap-6 items-start"},$t={class:"md:col-span-2"},It=["value"],Rt={class:"bg-slate-50 rounded-xl border px-4 py-4 flex flex-col gap-2 justify-between"},Bt={class:"space-y-1 text-sm"},Gt={class:"flex justify-between"},At={class:"flex justify-between"},Ot={class:"border-t mt-2 pt-2 flex justify-between font-semibold"},zt={class:"bg-white rounded-2xl shadow-sm border p-6"},Lt={class:"flex items-center justify-between mb-4"},qt={class:"flex items-center gap-4"},Ht={class:"text-right text-xs mr-4"},Jt={class:"font-medium"},Wt={class:"font-medium text-emerald-700"},Yt=["disabled"],Kt={class:"overflow-x-auto"},Qt={class:"w-full text-xs md:text-sm"},Xt={class:"p-2"},Zt={class:"p-2"},te={class:"p-2"},ee={class:"p-2"},se={class:"line-clamp-2"},le={class:"p-2 text-right font-medium"},oe={class:"p-2 text-right"},ae=["onClick"],de={key:0},ne={key:1,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40"},re={class:"bg-white rounded-2xl shadow-lg w-full max-w-md p-5 relative"},ie={class:"space-y-3 text-sm"},ue={key:0,class:"mt-1 text-[11px] text-red-500"},me={key:0,class:"mt-1 text-[11px] text-red-500"},xe={key:0,class:"mt-1 text-[11px] text-red-500"},pe={key:0,class:"mt-1 text-[11px] text-red-500"},be={key:0,class:"mt-1 text-[11px] text-red-500"},ce={class:"flex justify-end gap-2 mt-4"},ge=["disabled"],fe=["disabled"],Ve=U({__name:"Show",props:{sale:{}},setup(o){const u=o,j=[{title:"Dashboard",href:G().url},{title:"Ventas",href:"/sales"},{title:`Venta ${u.sale.series}-${u.sale.number}`,href:`/sales/${u.sale.id}`}],n=c(()=>u.sale.currency==="USD"?"$":"S/"),v=c(()=>Number(u.sale.paid_amount??0)),x=c(()=>Number(u.sale.balance??u.sale.total-v.value)),y=c(()=>x.value>.01),b=E(!1);function _(){return new Date().toISOString().substring(0,10)}const l=T({payment_date:_(),amount:y.value?x.value:u.sale.total,method:"efectivo",reference:"",notes:""});function D(){l.reset(),l.payment_date=_(),l.amount=y.value?x.value:u.sale.total,l.method="efectivo",b.value=!0}function k(){l.processing||(b.value=!1)}function M(){l.post(`/sales/${u.sale.id}/payments`,{preserveScroll:!0,onSuccess:()=>{b.value=!1}})}function P(N){confirm("¿Eliminar este pago? Esta acción no se puede deshacer.")&&R.delete(`/sales/${u.sale.id}/payments/${N}`,{preserveScroll:!0})}return(N,e)=>(r(),$(B,{breadcrumbs:j},{default:h(()=>[t("div",A,[t("div",null,[t("h1",O," Venta "+s(o.sale.series)+"-"+s(o.sale.number),1),t("p",z,[e[5]||(e[5]=g(" Estado: ",-1)),t("span",{class:w(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium",{"bg-emerald-50 text-emerald-700":o.sale.status==="paid","bg-amber-50 text-amber-700":o.sale.status==="partial","bg-slate-100 text-slate-700":o.sale.status==="issued"}])},s(o.sale.status),3)])]),t("div",L,[F(d(C),{href:`/sales/${o.sale.id}/edit`,class:"px-3 py-2 rounded-lg border bg-white hover:bg-slate-50 text-sm"},{default:h(()=>[...e[6]||(e[6]=[g(" Editar venta ",-1)])]),_:1},8,["href"]),F(d(C),{href:"/sales",class:"px-3 py-2 rounded-lg border bg-white hover:bg-slate-50 text-sm"},{default:h(()=>[...e[7]||(e[7]=[g(" Volver a ventas ",-1)])]),_:1})])]),t("div",q,[t("div",H,[t("div",J,[e[8]||(e[8]=t("p",{class:"text-xs text-muted-foreground uppercase mb-1 tracking-wide"}," Valor total ",-1)),t("p",W,s(n.value)+" "+s(Number(o.sale.total).toFixed(2)),1)]),t("div",Y,[e[9]||(e[9]=t("p",{class:"text-xs text-muted-foreground uppercase mb-1 tracking-wide"}," Retenido ",-1)),t("p",K,s(n.value)+" "+s(0 .toFixed(2)),1)]),t("div",Q,[e[10]||(e[10]=t("p",{class:"text-xs text-muted-foreground uppercase mb-1 tracking-wide"}," Cobrado ",-1)),t("p",X,s(n.value)+" "+s(v.value.toFixed(2)),1)]),t("div",Z,[e[11]||(e[11]=t("p",{class:"text-xs text-muted-foreground uppercase mb-1 tracking-wide"}," Por cobrar ",-1)),t("p",{class:w(["text-lg font-semibold",x.value<=.01?"text-emerald-600":"text-orange-600"])},s(n.value)+" "+s(x.value.toFixed(2)),3)])])]),Object.keys(d(l).errors).length?(r(),i("div",tt," Hay errores al registrar el pago. Revisa los campos. ")):m("",!0),t("div",et,[t("div",st,[e[17]||(e[17]=t("div",{class:"flex items-center gap-3"},[t("div",{class:"h-12 w-32 bg-slate-100 rounded-md flex items-center justify-center text-[10px] font-semibold text-slate-500"}," LOGO "),t("div",null,[t("p",{class:"text-sm font-semibold"},"AGENCIA DN"),t("p",{class:"text-xs text-muted-foreground"}," Marketing & Diseño Web ")])],-1)),t("div",lt,[t("div",null,[e[13]||(e[13]=t("p",{class:"text-[11px] uppercase tracking-wide text-muted-foreground"}," Venta ",-1)),t("p",ot,[e[12]||(e[12]=g(" No. ",-1)),t("span",at,s(o.sale.series)+"-"+s(o.sale.number),1)]),e[14]||(e[14]=t("p",{class:"mt-1 text-xs text-muted-foreground"}," Emitida por: Dani ",-1))]),t("div",dt,[t("div",nt,[e[15]||(e[15]=t("label",{class:"block text-[11px] font-medium mb-1"},"Serie",-1)),t("input",{value:o.sale.series,readonly:"",class:"w-full border rounded-lg px-2 py-1 text-xs text-right bg-gray-100 opacity-70"},null,8,rt)]),t("div",it,[e[16]||(e[16]=t("label",{class:"block text-[11px] font-medium mb-1"},"Número",-1)),t("input",{value:o.sale.number,readonly:"",class:"w-full border rounded-lg px-2 py-1 text-xs text-right bg-gray-100 opacity-70"},null,8,ut)])])])]),t("div",mt,[t("div",xt,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-xs font-medium mb-1"},"Cliente",-1)),t("input",{value:o.sale.customer?.name||"—",readonly:"",class:"w-full border rounded-lg px-2 py-2 text-sm bg-gray-100"},null,8,pt)]),t("div",bt,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-xs font-medium mb-1 opacity-60"}," Identificación ",-1)),t("input",{value:o.sale.customer?.document_number||"",readonly:"",class:"w-full border rounded-lg px-2 py-2 text-sm bg-gray-100 opacity-60",placeholder:"RUC / DNI"},null,8,ct)]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-xs font-medium mb-1 opacity-60"}," Teléfono ",-1)),t("input",{value:o.sale.customer?.phone||"",readonly:"",class:"w-full border rounded-lg px-2 py-2 text-sm bg-gray-100 opacity-60",placeholder:"Teléfono"},null,8,gt)])])]),t("div",ft,[t("div",null,[e[21]||(e[21]=t("label",{class:"block text-xs font-medium mb-1"},"Fecha emisión",-1)),t("input",{type:"date",value:o.sale.issue_date,readonly:"",class:"w-full border rounded-lg px-2 py-2 text-sm bg-gray-100"},null,8,vt)]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-xs font-medium mb-1"},"Fecha vencimiento",-1)),t("input",{type:"date",value:o.sale.due_date||"",readonly:"",class:"w-full border rounded-lg px-2 py-2 text-sm bg-gray-100"},null,8,yt)]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs font-medium mb-1"},"Moneda",-1)),t("input",{value:o.sale.currency==="USD"?"USD - Dólares":"PEN - Soles",readonly:"",class:"w-full border rounded-lg px-2 py-2 text-sm bg-gray-100"},null,8,ht)]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs font-medium mb-1"},"Condición de pago",-1)),t("input",{value:o.sale.payment_term||"",readonly:"",class:"w-full border rounded-lg px-2 py-2 text-sm bg-gray-100"},null,8,wt)])])]),t("div",_t,[t("div",kt,[t("table",Nt,[t("thead",Ft,[t("tr",Ct,[e[25]||(e[25]=t("th",{class:"p-2 w-56"},"Item facturable",-1)),e[26]||(e[26]=t("th",{class:"p-2 w-24"},"Unidad",-1)),e[27]||(e[27]=t("th",{class:"p-2 w-24 text-right"},"Precio un.",-1)),t("th",St,"Desc ("+s(n.value)+")",1),e[28]||(e[28]=t("th",{class:"p-2 w-20 text-right"},"IGV %",-1)),e[29]||(e[29]=t("th",{class:"p-2 w-20 text-right"},"Cantidad",-1)),e[30]||(e[30]=t("th",{class:"p-2 w-28 text-right"},"Total",-1))])]),t("tbody",null,[(r(!0),i(S,null,V(o.sale.items,a=>(r(),i("tr",{key:a.id,class:"border-b last:border-b-0"},[t("td",Vt,s(a.description),1),t("td",jt,s(a.unit||"UND"),1),t("td",Dt,s(n.value)+" "+s(Number(a.unit_price).toFixed(2)),1),t("td",Mt,s(n.value)+" "+s(Number(a.discount||0).toFixed(2)),1),t("td",Pt,s(Number(a.tax_percent??0).toFixed(0))+"% ",1),t("td",Ut,s(Number(a.quantity).toFixed(3)),1),t("td",Et,s(n.value)+" "+s(Number(a.total).toFixed(2)),1)]))),128))])])]),t("div",Tt,[t("div",$t,[e[31]||(e[31]=t("label",{class:"block text-xs font-medium mb-1"}," Notas ",-1)),t("textarea",{value:o.sale.notes||"",readonly:"",rows:"3",class:"w-full border rounded-lg px-3 py-2 text-sm bg-gray-100",placeholder:"Notas adicionales..."},null,8,It)]),t("div",Rt,[t("div",Bt,[t("div",Gt,[e[32]||(e[32]=t("span",{class:"text-muted-foreground"},"Subtotal",-1)),t("span",null,s(n.value)+" "+s(Number(o.sale.subtotal).toFixed(2)),1)]),t("div",At,[e[33]||(e[33]=t("span",{class:"text-muted-foreground"},"IGV",-1)),t("span",null,s(n.value)+" "+s(Number(o.sale.tax).toFixed(2)),1)]),t("div",Ot,[e[34]||(e[34]=t("span",null,"Total",-1)),t("span",null,s(n.value)+" "+s(Number(o.sale.total).toFixed(2)),1)])])])])])]),t("div",zt,[t("div",Lt,[e[38]||(e[38]=t("div",null,[t("h2",{class:"text-sm font-semibold"},"Pagos registrados"),t("p",{class:"text-xs text-muted-foreground mt-1"}," Registra los pagos asociados a esta venta. ")],-1)),t("div",qt,[t("div",Ht,[t("div",null,[e[35]||(e[35]=t("span",{class:"text-muted-foreground mr-1"},"Total venta:",-1)),t("span",Jt,s(n.value)+" "+s(Number(o.sale.total).toFixed(2)),1)]),t("div",null,[e[36]||(e[36]=t("span",{class:"text-muted-foreground mr-1"},"Pagado:",-1)),t("span",Wt,s(n.value)+" "+s(v.value.toFixed(2)),1)]),t("div",null,[e[37]||(e[37]=t("span",{class:"text-muted-foreground mr-1"},"Saldo:",-1)),t("span",{class:w(["font-semibold",x.value<=.01?"text-emerald-700":"text-amber-700"])},s(n.value)+" "+s(x.value.toFixed(2)),3)])]),t("button",{class:"px-3 py-2 rounded-lg bg-primary text-primary-foreground text-sm disabled:opacity-50",disabled:!y.value,onClick:D}," Registrar pago ",8,Yt)])]),t("div",Kt,[t("table",Qt,[e[40]||(e[40]=t("thead",{class:"bg-slate-50 border-y"},[t("tr",{class:"text-left"},[t("th",{class:"p-2 w-24"},"Fecha"),t("th",{class:"p-2 w-32"},"Método"),t("th",{class:"p-2 w-32"},"Referencia"),t("th",{class:"p-2"},"Notas"),t("th",{class:"p-2 text-right w-28"},"Monto"),t("th",{class:"p-2 text-right w-12"})])],-1)),t("tbody",null,[(r(!0),i(S,null,V(o.sale.payments,a=>(r(),i("tr",{key:a.id,class:"border-b last:border-b-0"},[t("td",Xt,s(a.payment_date),1),t("td",Zt,s(a.method||"—"),1),t("td",te,s(a.reference||"—"),1),t("td",ee,[t("span",se,s(a.notes||"—"),1)]),t("td",le,s(n.value)+" "+s(Number(a.amount).toFixed(2)),1),t("td",oe,[t("button",{type:"button",class:"text-xs text-red-600 hover:underline",onClick:ve=>P(a.id)}," Eliminar ",8,ae)])]))),128)),o.sale.payments.length===0?(r(),i("tr",de,[...e[39]||(e[39]=[t("td",{colspan:"6",class:"p-4 text-center text-xs text-muted-foreground"}," Aún no hay pagos registrados para esta venta. ",-1)])])):m("",!0)])])])]),b.value?(r(),i("div",ne,[t("div",re,[t("div",{class:"flex items-center justify-between mb-3"},[e[41]||(e[41]=t("h3",{class:"text-sm font-semibold"}," Registrar pago ",-1)),t("button",{type:"button",class:"text-slate-500 hover:text-slate-700 text-lg leading-none",onClick:k}," × ")]),t("div",ie,[t("div",null,[e[42]||(e[42]=t("label",{class:"block text-xs font-medium mb-1"},"Fecha",-1)),p(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=a=>d(l).payment_date=a),class:"w-full border rounded-lg px-2 py-2 text-sm"},null,512),[[f,d(l).payment_date]]),d(l).errors.payment_date?(r(),i("p",ue,s(d(l).errors.payment_date),1)):m("",!0)]),t("div",null,[e[44]||(e[44]=t("label",{class:"block text-xs font-medium mb-1"},"Método",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>d(l).method=a),class:"w-full border rounded-lg px-2 py-2 text-sm"},[...e[43]||(e[43]=[t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"transferencia"},"Transferencia",-1),t("option",{value:"tarjeta_credito"},"Tarjeta de crédito",-1),t("option",{value:"tarjeta_debito"},"Tarjeta de débito",-1),t("option",{value:"yape_plin"},"Yape / Plin",-1),t("option",{value:""},"Otro / No especificado",-1)])],512),[[I,d(l).method]]),d(l).errors.method?(r(),i("p",me,s(d(l).errors.method),1)):m("",!0)]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-xs font-medium mb-1"},"Referencia",-1)),p(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>d(l).reference=a),class:"w-full border rounded-lg px-2 py-2 text-sm",placeholder:"N° operación, voucher…"},null,512),[[f,d(l).reference]]),d(l).errors.reference?(r(),i("p",xe,s(d(l).errors.reference),1)):m("",!0)]),t("div",null,[e[46]||(e[46]=t("label",{class:"block text-xs font-medium mb-1"},"Monto",-1)),p(t("input",{type:"number",step:"0.01","onUpdate:modelValue":e[3]||(e[3]=a=>d(l).amount=a),class:"w-full border rounded-lg px-2 py-2 text-sm text-right"},null,512),[[f,d(l).amount,void 0,{number:!0}]]),d(l).errors.amount?(r(),i("p",pe,s(d(l).errors.amount),1)):m("",!0)]),t("div",null,[e[47]||(e[47]=t("label",{class:"block text-xs font-medium mb-1"},"Notas",-1)),p(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>d(l).notes=a),rows:"3",class:"w-full border rounded-lg px-2 py-2 text-sm",placeholder:"Notas internas sobre este pago..."},null,512),[[f,d(l).notes]]),d(l).errors.notes?(r(),i("p",be,s(d(l).errors.notes),1)):m("",!0)])]),t("div",ce,[t("button",{type:"button",class:"px-3 py-2 rounded-lg border bg-white text-sm",disabled:d(l).processing,onClick:k}," Cancelar ",8,ge),t("button",{type:"button",class:"px-4 py-2 rounded-lg bg-primary text-primary-foreground text-sm",disabled:d(l).processing,onClick:M}," Guardar pago ",8,fe)])])])):m("",!0)]),_:1}))}});export{Ve as default};
